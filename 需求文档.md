# 需求文档

# 📄 需求文档：个人文件中转站

**版本**：v1.0  
**日期**：2025-01-07

---

## 一、需求概述

在个人 Linux 服务器上部署一套轻量级文件中转服务，支持管理员（单人）通过 Web 界面上传和管理文件，外部用户通过分享链接下载文件。核心价值是**跨设备、可控期限、可加密保护**的文件中转能力。

|项目|内容|
| ----------| ------------------------------------|
|目标用户|管理员（上传/管理）+ 访客（下载）|
|使用场景|个人跨设备文件传递、向他人分享文件|
|部署环境|Linux 服务器，Web UI 访问|
|并发规模|≤ 3 人同时访问|

---

## 二、功能需求

### 🔴 P0 核心功能

#### 1. 管理员认证模块

- 管理员通过账号密码登录后台管理界面
- 登录态保持（Session / Token 机制）
- 未登录状态无法访问上传、删除等管理功能
- 支持退出登录

#### 2. 文件上传模块

- 支持通过 Web 界面选择本地文件上传至服务器
- 支持单次上传单个文件（拖拽上传为 P1）
- 单文件大小上限可在系统配置中自定义设置
- 上传进度可见（进度条或百分比）
- 上传成功后自动进入文件列表

#### 3. 文件列表模块

- 以平铺列表形式展示所有已上传文件
- 每条记录显示：文件名、文件大小、上传时间、有效期、分享状态
- 支持删除文件（同时使对应分享链接失效）

#### 4. 分享链接模块

- 为每个文件生成唯一分享链接
- 链接有效期支持自定义输入，并提供快捷选项：1天 / 7天 / 30天 / 永久
- 支持设置提取码（4~8位字母数字，可手动填写或随机生成）
- 提取码为可选项，不设置则直接访问链接即可下载
- 同一文件可重新生成新链接（旧链接同时失效）
- 链接过期后访问提示「链接已失效」

#### 5. 访客下载模块

- 访客通过分享链接访问下载页
- 若设有提取码，需先输入正确提取码才能看到下载按钮
- 提取码错误给予明确提示
- 点击下载按钮触发文件下载
- 链接失效时展示友好错误页面（非500报错）

---

### 🟡 P1 重要功能

#### 6. 文件过期自动清理

- 系统定时任务检测过期文件（建议每小时执行一次）
- 过期文件的分享链接自动失效
- 【假设①】过期后文件实体**保留在服务器磁盘**，仅链接失效，管理员手动删除

  - *如需过期自动删除文件实体，请确认*

#### 7. 下载次数限制（可选配置）

- 创建分享链接时可选填最大下载次数
- 达到次数上限后链接自动失效
- 不填写则不限次数

#### 8. 拖拽上传

- 支持拖拽文件到上传区域触发上传

---

### 🟢 P2 增强功能

#### 9. 分享链接复制

- 一键复制完整分享链接到剪贴板
- 若有提取码，支持同时复制「链接+提取码」组合文本

#### 10. 文件列表搜索/排序

- 支持按文件名关键词搜索
- 支持按上传时间、文件大小排序

---

## 三、非功能需求

|类别|要求|
| ------| -----------------------------------------------------------------------------------------------------------------|
|**性能**|支持 ≤3 人并发下载，单文件下载速度受限于服务器带宽，无需额外优化|
|**安全**|管理后台必须登录才可访问；分享链接使用不可猜测的随机 Token（建议 UUID 或 16位以上随机串）；提取码传输需走 HTTPS|
|**可用性**|Web UI 兼容主流现代浏览器（Chrome / Firefox / Safari / Edge）；移动端浏览器可正常访问下载页|
|**可维护性**|支持通过配置文件修改：单文件大小上限、存储路径、管理员账号密码|
|**存储**|文件直接存储于服务器本地磁盘，无需对接对象存储|

---

## 四、边界与约束

### ✅ 做什么

- 单管理员上传、管理文件
- 访客凭链接（+可选提取码）下载文件
- Web 界面操作

### ❌ 不做什么

- 不支持多用户注册与权限隔离
- 不支持文件夹/目录层级管理
- 不支持在线预览（图片、视频、文档等）
- 不支持文件编辑或重命名（可作 P2 后续迭代）
- 不提供 App 客户端（Web 即终态）
- 不对接第三方云存储

### ⚠️ 技术约束

- 部署环境：Linux 服务器
- 访问方式：Web 浏览器
- 技术栈不限，优先选择**轻量易部署**方案，避免引入重型中间件

---

## 五、验收标准

### AC-01 管理员登录

```
Given 用户访问后台管理页面
When  输入正确的账号和密码并提交
Then  成功进入文件管理界面，页面显示文件列表
```

```
Given 用户访问后台管理页面
When  输入错误的密码并提交
Then  页面显示「账号或密码错误」，停留在登录页
```

### AC-02 文件上传

```
Given 管理员已登录，选择一个 500MB 的文件（未超出配置上限）
When  点击上传按钮
Then  上传进度条正常推进，上传完成后文件出现在列表中
```

```
Given 管理员已登录，选择一个超出配置大小上限的文件
When  点击上传按钮
Then  上传被拒绝，页面提示「文件超过最大限制 xMB」
```

### AC-03 生成分享链接

```
Given 管理员在文件列表中选择某文件，设置有效期为 7天，设置提取码为 abc123
When  点击「生成链接」
Then  生成一条包含随机 Token 的分享链接，同时展示提取码，可一键复制
```

```
Given 管理员为同一文件再次点击「生成新链接」
When  确认操作
Then  生成新链接，旧链接访问后提示「链接已失效」
```

### AC-04 访客下载（有提取码）

```
Given 访客打开一条设有提取码的有效分享链接
When  输入正确提取码并确认
Then  页面展示下载按钮，点击后文件开始下载
```

```
Given 访客打开一条设有提取码的有效分享链接
When  输入错误提取码并确认
Then  页面提示「提取码错误」，不展示下载按钮
```

### AC-05 链接过期

```
Given 一条有效期为 1天 的分享链接已超过 24小时
When  任意访客访问该链接
Then  页面显示友好提示「该链接已过期或不存在」，不触发下载
```

### AC-06 下载次数限制

```
Given 分享链接设置最大下载次数为 3次，当前已下载 3次
When  第 4 位访客访问该链接并尝试下载
Then  页面提示「该链接已达下载上限」，无法继续下载
```

### AC-07 管理员删除文件

```
Given 管理员在文件列表中点击某文件的「删除」按钮
When  确认删除操作
Then  文件从列表中消失，对应分享链接立即失效，访客访问提示「链接已失效」
```

---
